import time, os
import numpy as np
from utils.db_utils import postgres_db, get_known_id_name_encoding, get_name_from_txt
from multiprocessing import Pool, Queue
import queue
import json
import tensorflow as tf

g_search_list = list(range(10000))
def face_distance1(k):
    count = 0
    for i in range(10000):
        count += pow(3 * 2, 3 * 2) if i in g_search_list else 0
    return 0

def face_distance(encoding, known_encodings):
    """
    计算encoding与known_encodings的Euclidean距离
    :param known_encodings: 已知的所有脸的encoding
    :param encoding: 给定的未知的encoding
    :return: 返回一个列表, 每个元素是与encoding的欧氏距离
    """
    if len(encoding) == 0:
        return np.empty((0))
    distance_list = np.linalg.norm(known_encodings - encoding, axis=1)
    # distance_list = np.asarray([np.sqrt(np.sum(np.square(know-encoding))) for know in known_encodings])

    min_distance = distance_list.min()
    return min_distance


def normal(num):
    start_time = time.time()
    for i in range(num):
        face_distance(encoding, known_face_encodings)
    print('Normal time:', time.time()-start_time)


if __name__ == "__main__":
    # with open('store1.json', 'r') as file:
    #     load_json = json.load(file)
    #     known_face_encodings = [record['encoding'] for record in load_json['RECORDS']]
    #
    # known_face_encodings = np.asarray(known_face_encodings)

    _encoding = [-0.093578368, 0.0608885399997, 0.1247200071811, 0.04405299201607704, -0.13056406378746033, -0.013945810496807098, -0.05365172028541565, -0.004641295410692692, 0.11963321268558502, -0.027570119127631187, 0.16990990936756134, -0.06207938864827156, -0.2383289486169815, -0.04045316204428673, -0.011076994240283966, 0.09012264758348465, -0.0627904012799263, -0.10336872935295105, -0.0942816287279129, -0.0812377780675888, 0.0337333045899868, 0.07311089336872101, 0.027029290795326233, -0.03657391667366028, -0.130214661359787, -0.39121878147125244, -0.0851258635520935, -0.10212770849466324, 0.08639497309923172, -0.13901367783546448, 0.09523005038499832, 0.04749007523059845, -0.12929388880729675, -0.020632296800613403, 0.05990440398454666, 0.1298942118883133, -0.015157386660575867, -0.11733869463205338, 0.26601195335388184, -0.04047132283449173, -0.13771775364875793, -0.02889402210712433, 0.0238407701253891, 0.21519866585731506, 0.04688432812690735, -0.001715056598186493, 0.03542109578847885, -0.008042633533477783, 0.0730970948934555, -0.27868378162384033, 0.12105400860309601, 0.1557871401309967, 0.08952204883098602, 0.07879872620105743, 0.12473717331886292, -0.1272672414779663, 0.09285539388656616, 0.14479181170463562, -0.30089595913887024, 0.07855042815208435, 0.0869305208325386, -0.07538343966007233, -0.11926195025444031, 0.0008466988801956177, 0.15817447006702423, 0.17420366406440735, -0.07674848288297653, -0.15893299877643585, 0.09877519309520721, -0.1727767139673233, 0.027181698009371758, 0.1034061461687088, -0.07326452434062958, -0.11669819056987762, -0.2491554617881775, 0.06695902347564697, 0.4147722125053406, 0.087904192507267, -0.17118409276008606, 0.0006183050572872162, 0.0004140101373195648, -0.008993290364742279, 0.04985690116882324, -0.02827078104019165, -0.14884822070598602, -0.0424453467130661, -0.06484538316726685, 0.0976136326789856, 0.12759163975715637, 0.0457083135843277, -0.05457472801208496, 0.1576194018125534, 0.0200495645403862, 0.02919987589120865, 0.06203563138842583, 0.006581105291843414, 0.005230367183685303, -0.07163871079683304, -0.00938323512673378, 0.08095254749059677, 0.15437711775302887, -0.14297276735305786, -0.003974437713623047, 0.02670574188232422, -0.19727756083011627, 0.1231844425201416, -0.029850944876670837, -0.06905731558799744, 0.048657432198524475, -0.012762084603309631, -0.17916260659694672, 0.055740296840667725, 0.253547340631485, -0.3253766894340515, 0.24976065754890442, 0.1361531913280487, -0.046314142644405365, 0.14321249723434448, 0.05581691116094589, 0.06918521970510483, 0.006652578711509705, -0.05592974275350571, -0.12530291080474854, -0.11243221163749695, 0.0026820674538612366, -0.04918771982192993, 0.002157852053642273, 0.02434435486793518]
    known_face_encodings = [[-0.09357836842536926, 0.060888539999723434, 0.1247200071811676, 0.04405299201607704, -0.13056406378746033, -0.013945810496807098, -0.05365172028541565, -0.004641295410692692, 0.11963321268558502, -0.027570119127631187, 0.16990990936756134, -0.06207938864827156, -0.2383289486169815, -0.04045316204428673, -0.011076994240283966, 0.09012264758348465, -0.0627904012799263, -0.10336872935295105, -0.0942816287279129, -0.0812377780675888, 0.0337333045899868, 0.07311089336872101, 0.027029290795326233, -0.03657391667366028, -0.130214661359787, -0.39121878147125244, -0.0851258635520935, -0.10212770849466324, 0.08639497309923172, -0.13901367783546448, 0.09523005038499832, 0.04749007523059845, -0.12929388880729675, -0.020632296800613403, 0.05990440398454666, 0.1298942118883133, -0.015157386660575867, -0.11733869463205338, 0.26601195335388184, -0.04047132283449173, -0.13771775364875793, -0.02889402210712433, 0.0238407701253891, 0.21519866585731506, 0.04688432812690735, -0.001715056598186493, 0.03542109578847885, -0.008042633533477783, 0.0730970948934555, -0.27868378162384033, 0.12105400860309601, 0.1557871401309967, 0.08952204883098602, 0.07879872620105743, 0.12473717331886292, -0.1272672414779663, 0.09285539388656616, 0.14479181170463562, -0.30089595913887024, 0.07855042815208435, 0.0869305208325386, -0.07538343966007233, -0.11926195025444031, 0.0008466988801956177, 0.15817447006702423, 0.17420366406440735, -0.07674848288297653, -0.15893299877643585, 0.09877519309520721, -0.1727767139673233, 0.027181698009371758, 0.1034061461687088, -0.07326452434062958, -0.11669819056987762, -0.2491554617881775, 0.06695902347564697, 0.4147722125053406, 0.087904192507267, -0.17118409276008606, 0.0006183050572872162, 0.0004140101373195648, -0.008993290364742279, 0.04985690116882324, -0.02827078104019165, -0.14884822070598602, -0.0424453467130661, -0.06484538316726685, 0.0976136326789856, 0.12759163975715637, 0.0457083135843277, -0.05457472801208496, 0.1576194018125534, 0.0200495645403862, 0.02919987589120865, 0.06203563138842583, 0.006581105291843414, 0.005230367183685303, -0.07163871079683304, -0.00938323512673378, 0.08095254749059677, 0.15437711775302887, -0.14297276735305786, -0.003974437713623047, 0.02670574188232422, -0.19727756083011627, 0.1231844425201416, -0.029850944876670837, -0.06905731558799744, 0.048657432198524475, -0.012762084603309631, -0.17916260659694672, 0.055740296840667725, 0.253547340631485, -0.3253766894340515, 0.24976065754890442, 0.1361531913280487, -0.046314142644405365, 0.14321249723434448, 0.05581691116094589, 0.06918521970510483, 0.006652578711509705, -0.05592974275350571, -0.12530291080474854, -0.11243221163749695, 0.0026820674538612366, -0.04918771982192993, 0.002157852053642273, 0.02434435486793518],]

    encoding = np.asarray(_encoding)

    dist = face_distance(encoding, known_face_encodings)
    print(dist)

    # process_num(4)

